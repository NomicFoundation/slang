//SPDX-License-Identifier: MIT
//           _____                    _____                    _____                _____                            _____                    _____                _____                            _____                    _____                    _____                _____                    _____                    _____                    _____                _____          
//          /\    \                  /\    \                  /\    \              /\    \                          /\    \                  /\    \              /\    \                          /\    \                  /\    \                  /\    \              /\    \                  /\    \                  /\    \                  /\    \              /\    \         
//         /::\    \                /::\    \                /::\    \            /::\    \                        /::\    \                /::\    \            /::\    \                        /::\    \                /::\    \                /::\    \            /::\    \                /::\    \                /::\    \                /::\    \            /::\    \        
//        /::::\    \              /::::\    \              /::::\    \           \:::\    \                      /::::\    \              /::::\    \           \:::\    \                      /::::\    \              /::::\    \              /::::\    \           \:::\    \              /::::\    \              /::::\    \              /::::\    \           \:::\    \       
//       /::::::\    \            /::::::\    \            /::::::\    \           \:::\    \                    /::::::\    \            /::::::\    \           \:::\    \                    /::::::\    \            /::::::\    \            /::::::\    \           \:::\    \            /::::::\    \            /::::::\    \            /::::::\    \           \:::\    \      
//      /:::/\:::\    \          /:::/\:::\    \          /:::/\:::\    \           \:::\    \                  /:::/\:::\    \          /:::/\:::\    \           \:::\    \                  /:::/\:::\    \          /:::/\:::\    \          /:::/\:::\    \           \:::\    \          /:::/\:::\    \          /:::/\:::\    \          /:::/\:::\    \           \:::\    \     
//     /:::/  \:::\    \        /:::/__\:::\    \        /:::/__\:::\    \           \:::\    \                /:::/__\:::\    \        /:::/__\:::\    \           \:::\    \                /:::/__\:::\    \        /:::/__\:::\    \        /:::/__\:::\    \           \:::\    \        /:::/__\:::\    \        /:::/__\:::\    \        /:::/  \:::\    \           \:::\    \    
//    /:::/    \:::\    \      /::::\   \:::\    \      /::::\   \:::\    \          /::::\    \              /::::\   \:::\    \      /::::\   \:::\    \          /::::\    \              /::::\   \:::\    \      /::::\   \:::\    \       \:::\   \:::\    \          /::::\    \      /::::\   \:::\    \      /::::\   \:::\    \      /:::/    \:::\    \          /::::\    \   
//   /:::/    / \:::\    \    /::::::\   \:::\    \    /::::::\   \:::\    \        /::::::\    \            /::::::\   \:::\    \    /::::::\   \:::\    \        /::::::\    \            /::::::\   \:::\    \    /::::::\   \:::\    \    ___\:::\   \:::\    \        /::::::\    \    /::::::\   \:::\    \    /::::::\   \:::\    \    /:::/    / \:::\    \        /::::::\    \  
//  /:::/    /   \:::\ ___\  /:::/\:::\   \:::\    \  /:::/\:::\   \:::\____\      /:::/\:::\    \          /:::/\:::\   \:::\    \  /:::/\:::\   \:::\____\      /:::/\:::\    \          /:::/\:::\   \:::\    \  /:::/\:::\   \:::\ ___\  /\   \:::\   \:::\    \      /:::/\:::\    \  /:::/\:::\   \:::\____\  /:::/\:::\   \:::\    \  /:::/    /   \:::\    \      /:::/\:::\    \ 
// /:::/____/     \:::|    |/:::/  \:::\   \:::\____\/:::/  \:::\   \:::|    |    /:::/  \:::\____\        /:::/  \:::\   \:::\____\/:::/  \:::\   \:::|    |    /:::/  \:::\____\        /:::/  \:::\   \:::\____\/:::/__\:::\   \:::|    |/::\   \:::\   \:::\____\    /:::/  \:::\____\/:::/  \:::\   \:::|    |/:::/  \:::\   \:::\____\/:::/____/     \:::\____\    /:::/  \:::\____\
// \:::\    \     /:::|____|\::/    \:::\  /:::/    /\::/   |::::\  /:::|____|   /:::/    \::/    /        \::/    \:::\  /:::/    /\::/   |::::\  /:::|____|   /:::/    \::/    /        \::/    \:::\  /:::/    /\:::\   \:::\  /:::|____|\:::\   \:::\   \::/    /   /:::/    \::/    /\::/   |::::\  /:::|____|\::/    \:::\  /:::/    /\:::\    \      \::/    /   /:::/    \::/    /
//  \:::\    \   /:::/    /  \/____/ \:::\/:::/    /  \/____|:::::\/:::/    /   /:::/    / \/____/          \/____/ \:::\/:::/    /  \/____|:::::\/:::/    /   /:::/    / \/____/          \/____/ \:::\/:::/    /  \:::\   \:::\/:::/    /  \:::\   \:::\   \/____/   /:::/    / \/____/  \/____|:::::\/:::/    /  \/____/ \:::\/:::/    /  \:::\    \      \/____/   /:::/    / \/____/ 
//   \:::\    \ /:::/    /            \::::::/    /         |:::::::::/    /   /:::/    /                            \::::::/    /         |:::::::::/    /   /:::/    /                            \::::::/    /    \:::\   \::::::/    /    \:::\   \:::\    \      /:::/    /                 |:::::::::/    /            \::::::/    /    \:::\    \              /:::/    /          
//    \:::\    /:::/    /              \::::/    /          |::|\::::/    /   /:::/    /                              \::::/    /          |::|\::::/    /   /:::/    /                              \::::/    /      \:::\   \::::/    /      \:::\   \:::\____\    /:::/    /                  |::|\::::/    /              \::::/    /      \:::\    \            /:::/    /           
//     \:::\  /:::/    /               /:::/    /           |::| \::/____/    \::/    /                               /:::/    /           |::| \::/____/    \::/    /                               /:::/    /        \:::\  /:::/    /        \:::\  /:::/    /    \::/    /                   |::| \::/____/               /:::/    /        \:::\    \           \::/    /            
//      \:::\/:::/    /               /:::/    /            |::|  ~|           \/____/                               /:::/    /            |::|  ~|           \/____/                               /:::/    /          \:::\/:::/    /          \:::\/:::/    /      \/____/                    |::|  ~|                    /:::/    /          \:::\    \           \/____/             
//       \::::::/    /               /:::/    /             |::|   |                                                /:::/    /             |::|   |                                                /:::/    /            \::::::/    /            \::::::/    /                                  |::|   |                   /:::/    /            \:::\    \                              
//        \::::/    /               /:::/    /              \::|   |                                               /:::/    /              \::|   |                                               /:::/    /              \::::/    /              \::::/    /                                   \::|   |                  /:::/    /              \:::\____\                             
//         \::/____/                \::/    /                \:|   |                                               \::/    /                \:|   |                                               \::/    /                \::/____/                \::/    /                                     \:|   |                  \::/    /                \::/    /                             
//          ~~                       \/____/                  \|___|                                                \/____/                  \|___|                                                \/____/                  ~~                       \/____/                                       \|___|                   \/____/                  \/____/                              
                                                                                                                                                                                                                                                                                                                                                                                       

pragma solidity ^0.8.0;

import "hardhat/console.sol";
import "@openzeppelin/contracts/token/ERC721/presets/ERC721PresetMinterPauserAutoId.sol";
import "@openzeppelin/contracts/utils/Counters.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

contract Darts is ERC721PresetMinterPauserAutoId, Ownable {
    using Strings for uint256;
    uint256 public DART_PRICE = 111000000000000000;
    uint public constant MAX_PURCHASABLE = 3;
    uint256 public constant MAX_NFT_SUPPLY = 1111;
    string UIRoot = "https://gateway.pinata.cloud/ipfs/QmSS6xiqnxsxAqGXtPjST5S5j6Z1UZk4i8qWoEJfJmPVdL/";

    using Counters for Counters.Counter;
    Counters.Counter private _tokenIds;
    
    constructor() ERC721PresetMinterPauserAutoId("Dart Art Abstract", "DARTS", UIRoot) {
        _tokenIds.increment();
    }
    
    function buy(uint16 pack) payable external {
        
        uint256 totalMinted = totalSupply();
        require(totalMinted < MAX_NFT_SUPPLY, "Sold out.");
        
 
        uint256 p = (DART_PRICE*pack);


        require(msg.value >= p, "Not enough ETH.");
        mintNFT(pack);
    }
    
    function mintNFT(uint16 amount)
    private
    {
        for (uint i = 0; i < amount; i++) { 
            _mint(msg.sender, _tokenIds.current());
            _tokenIds.increment();
        }
    }
    
    function tokenURI(uint256 tokenId) public view virtual override returns (string memory) {
        require(_exists(tokenId), "ERC721Metadata: URI query for nonexistent token");
        string memory baseURI = _baseURI();
        return bytes(baseURI).length > 0 ? string(abi.encodePacked(baseURI, tokenId.toString(), ".json")) : "";
    }

    function withdraw() public payable onlyOwner {
        require(payable(msg.sender).send(address(this).balance));
    }
}
