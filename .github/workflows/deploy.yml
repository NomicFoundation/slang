name: "deploy"

on:
  # Run using manual triggers from GitHub UI:
  # https://docs.github.com/en/actions/managing-workflow-runs/manually-running-a-workflow
  workflow_dispatch: {}

  # Run on pushes to 'main' branch':
  push:
    branches:
      - "main"

concurrency:
  group: "deploy"
  cancel-in-progress: true

jobs:
  check:
    uses: "./.github/workflows/_jobs_check.yml"

  github-pages:
    needs: "check"
    uses: "./.github/workflows/_jobs_github_pages.yml"

  changesets:
    needs: "check"
    uses: "./.github/workflows/_jobs_changesets.yml"

  publish:
    needs: "changesets"
    uses: "./.github/workflows/_jobs_publish.yml"
    env:
      # __TODO_REENABLE_PUBLISH__
      # SLANG_PUBLISH: "${{ needs.changesets.outputs.publish }}"
      SLANG_PUBLISH: "false"
