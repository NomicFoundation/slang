# yaml-language-server: $schema=../../../../../codegen/schema/topic.schema.json

- name: HexStringLiteral
  kind: Token
  sequence:
    - terminal: hex
    - choice:
        - delimitedBy:
            open: '"'
            optional:
              reference: PossiblySeparatedPairsOfHexDigits
            close: '"'
        - delimitedBy:
            open: "'"
            optional:
              reference: PossiblySeparatedPairsOfHexDigits
            close: "'"

- name: PossiblySeparatedPairsOfHexDigits
  kind: Token
  sequence:
    - repeat: { min: 2, max: 2, reference: HexCharacter }
    - zeroOrMore:
        sequence:
          - optional: { terminal: _ }
          - repeat: { min: 2, max: 2, reference: HexCharacter }

- name: HexCharacter
  kind: Token
  choice:
    - range:
        from: "0"
        to: "9"
    - range:
        from: a
        to: f
    - range:
        from: A
        to: F

- name: AsciiStringLiteral
  kind: Token
  choice:
    - reference: SingleQuotedAsciiStringLiteral
    - reference: DoubleQuotedAsciiStringLiteral

- name: SingleQuotedAsciiStringLiteral
  kind: Token
  delimitedBy:
    open: "'"
    zeroOrMore:
      config: { name: Run }
      choice:
        - oneOrMore:
            config: { name: Char }
            difference:
              minuend:
                range:
                  from: " "
                  to: "~"
              subtrahend:
                choice:
                  - terminal: "'"
                  - terminal: "\\"
        - reference: EscapeSequence
    close: "'"

- name: DoubleQuotedAsciiStringLiteral
  kind: Token
  delimitedBy:
    open: '"'
    zeroOrMore:
      config: { name: Run }
      choice:
        - oneOrMore:
            config: { name: Char }
            difference:
              minuend:
                range:
                  from: " "
                  to: "~"
              subtrahend:
                choice:
                  - terminal: '"'
                  - terminal: "\\"
        - reference: EscapeSequence
    close: '"'

- name: UnicodeStringLiteral
  kind: Token
  choice:
    - reference: SingleQuotedUnicodeStringLiteral
    - reference: DoubleQuotedUnicodeStringLiteral

- name: SingleQuotedUnicodeStringLiteral
  kind: Token
  delimitedBy:
    open: "unicode'"
    zeroOrMore:
      config: { name: Run }
      choice:
        - oneOrMore:
            config: { name: Char }
            not:
              choice:
                - terminal: "'"
                - terminal: "\\"
                - terminal: "\n"
                - terminal: "\r"
        - reference: EscapeSequence
    close: "'"

- name: DoubleQuotedUnicodeStringLiteral
  kind: Token
  delimitedBy:
    open: 'unicode"'
    zeroOrMore:
      config: { name: Run }
      choice:
        - oneOrMore:
            config: { name: Char }
            not:
              choice:
                - terminal: '"'
                - terminal: "\\"
                - terminal: "\n"
                - terminal: "\r"
        - reference: EscapeSequence
    close: '"'

- name: EscapeSequence
  kind: Token
  sequence:
    - terminal: "\\"
    - choice:
        - reference: AsciiEscape
        - reference: HexByteEscape
        - reference: UnicodeEscape

- name: AsciiEscape
  kind: Token
  choice:
    - terminal: n
    - terminal: r
    - terminal: t
    - terminal: "'"
    - terminal: '"'
    - terminal: "\\"
    - terminal: "\n"
    - terminal: "\r"

- name: HexByteEscape
  kind: Token
  sequence:
    - terminal: x
    - repeat:
        min: 2
        max: 2
        reference: HexCharacter

- name: UnicodeEscape
  kind: Token
  sequence:
    - terminal: u
    - repeat:
        min: 4
        max: 4
        reference: HexCharacter
