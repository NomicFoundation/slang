# yaml-language-server: $schema=../../schema/topic.schema.json

- name: grammar
  sequence:
    - reference: S
    - zeroOrMore:
        reference: production
        separator:
          reference: S
    - reference: S
    - end: ~
- name: production
  sequence:
    - reference: Identifier
    - reference: S
    - terminal: "="
    - reference: S
    - reference: expression
    - reference: S
    - terminal: ;
- name: expression
  oneOrMore:
    reference: sequence
    separator:
      sequence:
        - reference: S
        - terminal: "|"
        - reference: S
- name: sequence
  oneOrMore:
    reference: difference
    separator:
      reference: S
- name: difference
  sequence:
    - reference: negation
    - optional:
        sequence:
          - reference: S
          - terminal: "-"
          - reference: S
          - reference: negation
- name: negation
  sequence:
    - optional:
        sequence:
          - terminal: ¬
          - reference: S
    - reference: primary
- name: primary
  choice:
    - reference: EOF
    - reference: Any
    - reference: CharRange
    - reference: String
    - reference: productionReference
    - reference: grouped
    - reference: optional
    - reference: repeated
- name: productionReference
  reference: Identifier
- name: grouped
  sequence:
    - terminal: (
    - reference: S
    - reference: expression
    - reference: S
    - terminal: )
- name: repetitionPrefix
  sequence:
    - choice:
        - sequence:
            - reference: number
            - reference: S
            - optional:
                sequence:
                  - terminal: '…'
                  - reference: S
                  - optional:
                      sequence:
                        - reference: number
                        - reference: S
        - sequence:
            - terminal: '…'
            - reference: S
            - optional:
                sequence:
                  - reference: number
                  - reference: S
    - terminal: '*'
- name: repetitionSeparator
  sequence:
    - terminal: '/'
    - reference: S
    - reference: expression
- name: repeated
  sequence:
    - optional:
        sequence: 
          - reference: repetitionPrefix
          - reference: S
    - terminal: "{"
    - reference: S
    - reference: expression
    - reference: S
    - optional:
        sequence:
          - reference: repetitionSeparator
          - reference: S
    - terminal: "}"
- name: number
  oneOrMore:
    range: { from: '0', to: '9'}
- name: optional
  sequence:
    - terminal: "["
    - reference: S
    - reference: expression
    - reference: S
    - terminal: "]"
- name: EOF
  terminal: $
- name: Any
  terminal: "."
- name: String
  sequence:
    - terminal: "'"
    - zeroOrMore:
        reference: StringChar
    - terminal: "'"
- name: StringChar
  choice:
    - not:
        choice:
          - terminal: "'"
          - terminal: "\\"
    - sequence:
        - terminal: "\\"
        - choice:
            - terminal: "'"
            - terminal: "\\"
            - sequence:
                - terminal: "u{"
                - repeat:
                    min: 1
                    max: 6
                    reference: HexDigit
                - terminal: "}"
- name: CharRange
  sequence:
    - reference: SingleCharString
    - reference: S
    - terminal: …
    - reference: S
    - reference: SingleCharString
- name: SingleCharString
  sequence:
    - terminal: "'"
    - reference: StringChar
    - terminal: "'"
- name: HexDigit
  choice:
    - range:
        from: "0"
        to: "9"
    - range:
        from: a
        to: f
    - range:
        from: A
        to: F
- name: Identifier
  sequence:
    - reference: IdentifierStart
    - zeroOrMore:
        reference: IdentifierFollow
- name: IdentifierStart
  choice:
    - terminal: _
    - range:
        from: a
        to: z
    - range:
        from: A
        to: Z
- name: IdentifierFollow
  choice:
    - reference: IdentifierStart
    - range:
        from: "0"
        to: "9"
- name: S
  zeroOrMore:
    choice:
      - reference: Whitespace
      - reference: Comment
  config: { ignore: true }
- name: Comment
  sequence:
    - terminal: /*
    - zeroOrMore:
        choice:
          - not:
              terminal: "*"
          - sequence:
              - oneOrMore:
                  terminal: "*"
              - not:
                  choice:
                    - terminal: "*"
                    - terminal: /
    - oneOrMore:
        terminal: "*"
    - terminal: /
- name: Whitespace
  choice:
    - terminal: "\t"
    - terminal: "\n"
    - terminal: "\r"
    - terminal: " "
