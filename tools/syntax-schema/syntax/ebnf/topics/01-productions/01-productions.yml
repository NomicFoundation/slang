# yaml-language-server: $schema=../../../schema/topic.schema.json

- name: grammar
  sequence:
    - reference: LeadingTrivia
    - zeroOrMore:
        reference: production
    - reference: TrailingTrivia
    - end: ~

- name: production
  sequence:
    - reference: Identifier
    - terminal: "="
    - reference: expression
    - terminal: ;

- name: expression
  separatedBy:
    reference: sequence
    separator: "|"

- name: sequence
  oneOrMore:
    reference: difference

- name: difference
  sequence:
    - reference: negation
    - optional:
        sequence:
          - terminal: "-"
          - reference: negation

- name: negation
  sequence:
    - optional:
        terminal: ¬
    - reference: primary

- name: primary
  choice:
    - reference: productionReference
    - reference: grouped
    - reference: optional
    - reference: repeated
    - reference: charRange
    - reference: EOF
    - reference: String

- name: productionReference
  reference: Identifier

- name: grouped
  sequence:
    - terminal: (
    - reference: expression
    - terminal: )

- name: repetitionPrefix
  sequence:
    - choice:
        - sequence:
            - reference: Number
            - optional:
                sequence:
                  - terminal: "…"
                  - optional:
                      reference: Number
        - sequence:
            - terminal: "…"
            - reference: Number
    - terminal: "*"

- name: repetitionSeparator
  sequence:
    - terminal: "/"
    - reference: expression

- name: repeated
  sequence:
    - optional:
        reference: repetitionPrefix
    - terminal: "{"
    - reference: expression
    - optional:
        reference: repetitionSeparator
    - terminal: "}"

- name: optional
  sequence:
    - terminal: "["
    - reference: expression
    - terminal: "]"

- name: charRange
  sequence:
    - reference: SingleCharString
    - terminal: …
    - reference: SingleCharString

# Tokens

- name: EOF
  kind: Token
  terminal: $

- name: Number
  kind: Token
  oneOrMore:
    range: { from: "0", to: "9" }

- name: String
  kind: Token
  sequence:
    - terminal: "'"
    - zeroOrMore:
        reference: StringChar
    - terminal: "'"

- name: StringChar
  kind: Token
  choice:
    - not:
        choice:
          - terminal: "'"
          - terminal: "\\"
      config: { name: NotQuoteOrBackslash }
    - sequence:
        - terminal: "\\"
        - choice:
            - terminal: "'"
            - terminal: "\\"
            - sequence:
                - terminal: "u{"
                - repeat:
                    min: 1
                    max: 6
                    reference: HexDigit
                - terminal: "}"
          config: { name: QuoteOrBackslashOrHexEscape }
      config: { name: Escape }

- name: SingleCharString
  kind: Token
  sequence:
    - terminal: "'"
    - reference: StringChar
    - terminal: "'"

- name: HexDigit
  kind: Token
  choice:
    - range:
        from: "0"
        to: "9"
    - range:
        from: a
        to: f
    - range:
        from: A
        to: F

- name: Identifier
  kind: Token
  choice:
    - sequence:
        - terminal: «
        - reference: RawIdentifier
        - terminal: »
    - reference: RawIdentifier

- name: RawIdentifier
  kind: Token
  sequence:
    - reference: IdentifierStart
    - zeroOrMore:
        reference: IdentifierFollow

- name: IdentifierStart
  kind: Token
  choice:
    - terminal: _
    - range:
        from: a
        to: z
    - range:
        from: A
        to: Z

- name: IdentifierFollow
  kind: Token
  choice:
    - reference: IdentifierStart
    - range:
        from: "0"
        to: "9"

- name: LeadingTrivia
  kind: Token
  zeroOrMore:
    choice:
      - reference: Whitespace
      - reference: Comment

- name: TrailingTrivia
  kind: Token
  zeroOrMore:
    choice:
      - reference: Whitespace
      - reference: Comment

- name: Comment
  kind: Token
  sequence:
    - terminal: (*
    - sequence:
        - zeroOrMore:
            choice:
              - not:
                  terminal: "*"
              - sequence:
                  - oneOrMore:
                      terminal: "*"
                  - not:
                      choice:
                        - terminal: "*"
                        - terminal: )
        - zeroOrMore:
            terminal: "*"
      config: { name: Content }
    - terminal: "*)"

- name: Whitespace
  kind: Token
  oneOrMore:
    choice:
      - terminal: "\t"
      - terminal: "\n"
      - terminal: "\r"
      - terminal: " "
